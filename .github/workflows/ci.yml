# workflowì˜ ì´ë¦„
name: CI

# ì‹¤í–‰ íŠ¸ë¦¬ê±° (Push, PR, ìˆ˜ë™ ì‹¤í–‰ ì§€ì›)
on:
  push:
    branches: [ main ] 
  pull_request:
    branches: [ main ]
  workflow_dispatch:  # ğŸ‘ˆ ì´ ë¶€ë¶„ì„ ì¶”ê°€í•˜ë©´ GitHub Actionsì—ì„œ ì§ì ‘ ì‹¤í–‰ ê°€ëŠ¥

# workflowëŠ” í•˜ë‚˜ ì´ìƒì˜ jobì„ í¬í•¨í•˜ë©°, ê° jobì€ ì—¬ëŸ¬ stepì„ ê°€ì§
jobs:
  build:
    name: CI
    runs-on: ubuntu-latest

    steps:
      # ì‘ì—…ì—ì„œ ì•¡ì„¸ìŠ¤í•  ìˆ˜ ìˆë„ë¡ $GITHUB_WORKSPACEì—ì„œ ì €ì¥ì†Œë¥¼ ì²´í¬ì•„ì›ƒ
      - uses: actions/checkout@v2

      # JDK 21 (Zulu) ì„¤ì •
      - name: Set up JDK 21     
        uses: actions/setup-java@v2
        with:
          java-version: '21'
          distribution: 'zulu'

      # Gradle ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
      - name: Grant execute permission for gradlew
        run: chmod +x ./gradlew
        shell: bash
      
      # Gradle ë¹Œë“œ ì‹¤í–‰
      - name: Build with Gradle
        run: ./gradlew build
        shell: bash

      # ì†ŒìŠ¤ì»¤ë°‹ì— í‘¸ì‹œ
      - name: Configure Git
        run: |
          git config --global user.name "jdoeun"
          git config --global user.email "jde429@khu.ac.kr"

      - name: Add SourceCommit remote
        run: |
          git remote add sourcecommit https://${{ secrets.NCP_SOURCECOMMIT_USERNAME }}:${{ secrets.NCP_SOURCECOMMIT_PASSWORD }}@${{ secrets.NCP_SOURCECOMMIT_REPO_URL }}
          git fetch sourcecommit

      - name: Push changes to SourceCommit
        run: |
          git push --force sourcecommit main
